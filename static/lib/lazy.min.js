(function(w){function c(){}function x(a){this.sequence=a;this.index=-1}function r(){this.table={}}function e(){}function k(a){this.source=a}function l(a){this.source=a}function g(){}function n(a,b){this.source=a;this.mapFn=b}function s(a,b){this.iterator=a.getIterator();this.filterFn=b}function m(a){this.parent=a;a=a.source;a=200>a.length?m.prototype.eachNoCache:800>a.length?m.prototype.eachArrayCache:t.prototype.each;this.each=a}function p(a,b){this.get=a;this.fixedLength=b}function q(a,b){if(a instanceof
q)throw"Sequence is already asynchronous!";this.parent=a;this.onNextCallback=Z(b)}function Z(a){if("undefined"===typeof a){if("function"===typeof w.setImmediate)return w.setImmediate;if("undefined"!==typeof process&&"function"===typeof process.nextTick)return process.nextTick}a=a||0;return function(b){setTimeout(b,a)}}function y(a){this.source=a}function z(a,b){this.source=a;this.pattern=eval(""+b+(!b.global?"g":""))}function A(a,b){this.source=a;this.pattern=eval(""+b+(!b.global?"g":""))}function B(a,
b){this.source=a;this.delimiter=b}function u(a){this.source=a;this.index=-1}function J(a){var b=new r;j(a||[]).flatten().each(function(a){b.add(a)});return b}function C(a,b,d){return"function"===typeof d?C(d(a),d(b)):a===b?0:a>b?1:-1}function K(a,b,d){d=d||[0];for(var f=-1;++f<a.length;)if(a[f]instanceof Array){if(!1===K(a[f],b,d))return!1}else if(!1===b(a[f],d[0]++))return!1;return!0}function v(a,b){for(var d=-1,f=a.length;++d<f;)if(a[d]===b)return!0;return!1}function $(a){return Array(a).join("  ")}
c.inherit=function(a){a.prototype=new c;return a};c.prototype.depth=function(){return this.parent?this.parent.depth()+1:0};c.prototype.log=function(a){console.log($(this.depth())+a)};c.prototype.toArray=function(){var a=[];this.each(function(b){a.push(b)});return a};c.prototype.toObject=function(){var a={};this.each(function(b){a[b[0]]=b[1]});return a};c.prototype.forEach=function(a){this.each(a)};c.prototype.map=function(a){return new D(this,a)};c.prototype.collect=c.prototype.map;c.prototype.pluck=
function(a){return this.map(function(b){return b[a]})};c.prototype.invoke=function(a){return this.map(function(b){return b[a]()})};c.prototype.select=function(a){return new E(this,a)};c.prototype.filter=c.prototype.select;c.prototype.reject=function(a){return this.filter(function(b){return!a(b)})};c.prototype.where=function(a){return this.filter(function(b){for(var d in a)if(b[d]!==a[d])return!1;return!0})};c.prototype.reverse=function(){return new L(this)};c.prototype.concat=function(a){return new M(this,
Array.prototype.slice.call(arguments,0))};c.prototype.first=function(a){if("undefined"===typeof a){var b;this.each(function(a){b=a;return!1});return b}return new N(this,a)};c.prototype.head=c.prototype.take=c.prototype.first;c.prototype.initial=function(a){"undefined"===typeof a&&(a=1);return this.take(this.length()-a)};c.prototype.last=function(a){return"undefined"===typeof a?this.reverse().first():this.reverse().take(a).reverse()};c.prototype.findWhere=function(a){return this.where(a).first()};
c.prototype.rest=function(a){return new O(this,a)};c.prototype.tail=c.prototype.drop=c.prototype.rest;c.prototype.sortBy=function(a){return new P(this,a)};c.prototype.groupBy=function(a){return new aa(this,a)};c.prototype.countBy=function(a){return new ba(this,a)};c.prototype.uniq=function(){return new t(this)};c.prototype.unique=c.prototype.uniq;c.prototype.zip=function(a){return new Q(this,Array.prototype.slice.call(arguments,0))};c.prototype.shuffle=function(){return new R(this)};c.prototype.flatten=
function(){return new S(this)};c.prototype.compact=function(){return this.filter(function(a){return!!a})};c.prototype.without=function(a){return new T(this,Array.prototype.slice.call(arguments,0))};c.prototype.difference=c.prototype.without;c.prototype.union=function(a){return new U(this,Array.prototype.slice.call(arguments,0))};c.prototype.intersection=function(a){return new V(this,Array.prototype.slice.call(arguments,0))};c.prototype.every=function(a){var b=!0;this.each(function(d){if(!a(d))return b=
!1});return b};c.prototype.all=c.prototype.every;c.prototype.some=function(a){a||(a=function(){return!0});var b=!1;this.each(function(d){if(a(d))return b=!0,!1});return b};c.prototype.any=c.prototype.some;c.prototype.isEmpty=function(){return!this.any()};c.prototype.indexOf=function(a){var b=0,d=-1;this.each(function(f){if(f===a)return d=b,!1;++b});return d};c.prototype.lastIndexOf=function(a){a=this.reverse().indexOf(a);-1!==a&&(a=this.length()-a-1);return a};c.prototype.sortedIndex=function(a){for(var b=
0,d=this.length(),f;b<d;)f=b+d>>>1,-1===C(this.get(f),a)?b=f+1:d=f;return b};c.prototype.contains=function(a){return-1!==this.indexOf(a)};c.prototype.reduce=function(a,b){if(2>arguments.length)return this.tail().reduce(a,this.head());this.each(function(d,f){b=a(b,d,f)});return b};c.prototype.inject=c.prototype.foldl=c.prototype.reduce;c.prototype.reduceRight=function(a,b){var d=this.length()-1;return this.reverse().reduce(function(b,c){return a(b,c,d--)},b)};c.prototype.foldr=c.prototype.reduceRight;
c.prototype.find=function(a){return this.filter(a).first()};c.prototype.detect=c.prototype.find;c.prototype.min=function(){return this.reduce(function(a,b){return b<a?b:a})};c.prototype.max=function(){return this.reduce(function(a,b){return b>a?b:a})};c.prototype.sum=function(){return this.reduce(function(a,b){return a+b},0)};c.prototype.join=function(a){var b="";this.each(function(d){0<b.length&&(b+=a);b+=d});return b};c.prototype.getIterator=function(){return new x(this)};c.prototype.async=function(a){return new q(this,
a)};x.prototype.current=function(){return this.sequence.get(this.index)};x.prototype.moveNext=function(){if(this.index>=this.sequence.length()-1)return!1;++this.index;return!0};r.prototype.add=function(a){var b=this.table,d="@"+a;if(!b[d])return b[d]=[a],!0;if(v(b[d],a))return!1;b[d].push(a);return!0};r.prototype.contains=function(a){var b=this.table["@"+a];return b&&v(b,a)};e.prototype=new c;e.inherit=function(a){a.prototype=new e;return a};e.prototype.get=function(a){return this.parent.get(a)};
e.prototype.length=function(){return this.parent.length()};e.prototype.each=function(a){for(var b=this.length(),d=-1;++d<b&&!1!==a(this.get(d),d););};e.prototype.map=e.prototype.collect=function(a){return new W(this,a)};e.prototype.filter=e.prototype.select=function(a){return new F(this,a)};e.prototype.reverse=function(){return new X(this)};e.prototype.first=function(a){return"undefined"===typeof a?this.get(0):new Y(this,a)};e.prototype.head=e.prototype.take=e.prototype.first;e.prototype.rest=function(a){return new G(this,
a)};e.prototype.tail=e.prototype.drop=e.prototype.rest;k.prototype=new e;k.prototype.get=function(a){return this.source[a]};k.prototype.length=function(){return this.source.length};k.prototype.each=function(a){for(var b=-1;++b<this.source.length&&!1!==a(this.source[b],b););};k.prototype.map=function(a){return new n(this.source,a)};k.prototype.uniq=k.prototype.unique=function(){return new m(this)};k.prototype.toArray=function(){return this.source.slice(0)};l.prototype=new c;l.prototype.get=function(a){return this.source[a]};
l.prototype.each=function(a){var b=this.source,d;for(d in b)if(!1===a(b[d],d))break};l.prototype.keys=function(){return this.map(function(a,b){return b})};l.prototype.values=function(){return this.map(function(a){return a})};l.prototype.map=function(a){return new D(this,a)};l.prototype.toArray=function(){return this.map(function(a,b){return[b,a]}).toArray()};g.prototype=new c;g.inherit=function(a){a.prototype=new g;return a};g.prototype.cache=function(){this.cached||(this.cached=this.toArray());return this.cached};
g.prototype.get=function(a){return this.cache()[a]};g.prototype.length=function(){return this.cache().length};var D=c.inherit(function(a,b){this.parent=a;this.mapFn=b});D.prototype.each=function(a){var b=this.mapFn;this.parent.each(function(d,c){return a(b(d,c),c)})};var W=e.inherit(function(a,b){this.parent=a;this.mapFn=b});W.prototype.get=function(a){return this.mapFn(this.parent.get(a),a)};n.prototype=new e;n.prototype.get=function(a){return this.mapFn(this.source[a])};n.prototype.length=function(){return this.source.length};
n.prototype.each=function(a){for(var b=this.source,d=this.source.length,c=this.mapFn,h=-1;++h<d&&!1!==a(c(b[h],h),h););};var E=g.inherit(function(a,b){this.parent=a;this.filterFn=b});E.prototype.getIterator=function(){return new s(this.parent,this.filterFn)};E.prototype.each=function(a){var b=this.filterFn,d=0;this.parent.each(function(c,h){if(b(c,h))return a(c,d++)})};var F=g.inherit(function(a,b){this.parent=a;this.filterFn=b});F.prototype.getIterator=function(){return new s(this.parent,this.filterFn)};
F.prototype.each=function(a){for(var b=this.parent,d=this.filterFn,c=this.parent.length(),h=-1,ca=0,e;++h<c&&!(e=b.get(h),d(e,h)&&!1===a(e,ca++)););};s.prototype.current=function(){return this.value};s.prototype.moveNext=function(){for(var a=this.iterator,b=this.filterFn,d;a.moveNext();)if(d=a.current(),b(d))return this.value=d,!0;this.value=void 0;return!1};var L=g.inherit(function(a){this.parent=a});L.prototype.each=function(a){for(var b=this.parent.toArray(),d=b.length;0<=--d&&!1!==a(b[d]););};
var X=e.inherit(function(a){this.parent=a});X.prototype.get=function(a){return this.parent.get(this.length()-a-1)};var M=c.inherit(function(a,b){this.parent=a;this.arrays=b});M.prototype.each=function(a){var b=!1,d=0;this.parent.each(function(c){if(!1===a(c,d++))return b=!0,!1});b||j(this.arrays).flatten().each(function(b){if(!1===a(b,d++))return!1})};var N=g.inherit(function(a,b){this.parent=a;this.count=b});N.prototype.each=function(a){var b=this,d=0;b.parent.each(function(c){c=a(c);return++d>=
b.count?!1:c})};var Y=e.inherit(function(a,b){this.parent=a;this.count=b});Y.prototype.length=function(){var a=this.parent.length();return this.count<=a?this.count:a};var O=g.inherit(function(a,b){this.parent=a;this.count="number"===typeof b?b:1});O.prototype.each=function(a){var b=this,d=0;b.parent.each(function(c){if(!(d++<b.count))return a(c)})};var G=e.inherit(function(a,b){this.parent=a;this.count="number"===typeof b?b:1});G.prototype.get=function(a){return this.parent.get(this.count+a)};G.prototype.length=
function(){var a=this.parent.length();return this.count<=a?a-this.count:0};var P=g.inherit(function(a,b){this.parent=a;this.sortFn=b});P.prototype.each=function(a){var b=this.sortFn,d=this.parent.toArray(),c=-1;for(d.sort(function(a,c){return C(a,c,b)});++c<d.length&&!1!==a(d[c],c););};var R=g.inherit(function(a){this.parent=a});R.prototype.each=function(a){for(var b=this.parent.toArray(),c=Math.floor,f=Math.random,h=0,e=b.length-1;0<e;--e){var g=b,j=c(f()*e)+1,k=g[e];g[e]=g[j];g[j]=k;if(!1===a(b[e],
h++))return}a(b[0],h)};var aa=g.inherit(function(a,b){this.each=function(c){var f={};a.each(function(a){var c=b(a);f[c]?f[c].push(a):f[c]=[a]});for(var h in f)if(!1===c([h,f[h]]))break}}),ba=g.inherit(function(a,b){this.each=function(c){var f={};a.each(function(a){a=b(a);f[a]=f[a]?f[a]+1:1});for(var h in f)c([h,f[h]])}}),t=g.inherit(function(a){this.parent=a});t.prototype.each=function(a){var b=new r,c=0;this.parent.each(function(f){if(b.add(f))return a(f,c++)})};m.prototype=new g;m.prototype.eachNoCache=
function(a){for(var b=this.parent.source,c=b.length,f,h,e=-1,g,j=0;++e<c;){f=b[e];h=!1;for(g=e-1;0<=g;)if(b[g--]===f){h=!0;break}if(!h&&!1===a(b[e],j++))return!1}};m.prototype.eachArrayCache=function(a){for(var b=this.parent.source,c=b.length,f=[],h,e=-1,g=0;++e<c;)if(h=b[e],!v(f,h)&&(f.push(h),!1===a(h,g++)))return!1};m.prototype.eachSetCache=t.prototype.each;var S=g.inherit(function(a){this.parent=a});S.prototype.each=function(a){var b=[0];this.parent.each(function(c){return c instanceof Array?
K(c,a,b):a(c,b[0]++)})};var T=g.inherit(function(a,b){this.parent=a;this.values=b});T.prototype.each=function(a){var b=J(this.values),c=0;this.parent.each(function(f){if(!b.contains(f))return a(f,c++)})};var U=g.inherit(function(a,b){this.parent=a;this.arrays=b});U.prototype.each=function(a){var b={},c=0,f=!1;this.parent.each(function(e){if(!b[e]&&(b[e]=!0,!1===a(e,c++)))return f=!0,!1});f||j(this.arrays).each(function(e){if(f)return!1;j(e).each(function(e){if(!b[e]&&(b[e]=!0,!1===a(e,c++)))return f=
!0,!1})})};var V=g.inherit(function(a,b){this.parent=a;this.arrays=b});V.prototype.each=function(a){var b=j(this.arrays).map(function(a){return J(a)}).toArray(),c=0;this.parent.each(function(f){for(var e=-1;++e<b.length;)if(!b[e].contains(f))return;return a(f,c++)})};var Q=g.inherit(function(a,b){this.parent=a;this.arrays=b});Q.prototype.each=function(a){var b=this.arrays,c=0;this.parent.each(function(f){f=[f];for(var e=0;e<b.length;++e)b[e].length>c&&f.push(b[e][c]);return a(f,c++)})};p.prototype=
new c;p.prototype.length=function(){return this.fixedLength};p.prototype.each=function(a){for(var b=this.get,c=this.fixedLength,e=0;("undefined"===typeof c||e<c)&&!1!==a(b(e++)););};q.prototype=new c;q.prototype.each=function(a){var b=this.parent.getIterator(),c=this.onNextCallback;b.moveNext()&&c(function h(){!1!==a(b.current())&&b.moveNext()&&c(h)})};y.prototype.match=function(a){return new H(this.source,a)};y.prototype.split=function(a){return new I(this.source,a)};var H=c.inherit(function(a,b){this.source=
a;this.pattern=b});H.prototype.each=function(a){for(var b=this.getIterator();b.moveNext()&&!1!==a(b.current()););};H.prototype.getIterator=function(){return new z(this.source,this.pattern)};z.prototype.current=function(){return this.match[0]};z.prototype.moveNext=function(){return!!(this.match=this.pattern.exec(this.source))};var I=c.inherit(function(a,b){this.source=a;this.pattern=b});I.prototype.each=function(a){for(var b=this.getIterator();b.moveNext()&&!1!==a(b.current()););};I.prototype.getIterator=
function(){return this.pattern instanceof RegExp?""===this.pattern.source||"(?:)"===this.pattern.source?new u(this.source):new A(this.source,this.pattern):""===this.pattern?new u(this.source):new B(this.source,this.pattern)};A.prototype.current=function(){return this.source.substring(this.start,this.end)};A.prototype.moveNext=function(){if(!this.pattern)return!1;var a=this.pattern.exec(this.source);return a?(this.start=this.nextStart?this.nextStart:0,this.end=a.index,this.nextStart=a.index+a[0].length,
!0):this.pattern?(this.start=this.nextStart,this.pattern=this.nextStart=this.end=void 0,!0):!1};B.prototype.current=function(){return this.source.substring(this.leftIndex,this.rightIndex)};B.prototype.moveNext=function(){this.finished||(this.leftIndex="undefined"!==typeof this.leftIndex?this.rightIndex+this.delimiter.length:0,this.rightIndex=this.source.indexOf(this.delimiter,this.leftIndex));return-1===this.rightIndex?(this.finished=!0,this.rightIndex=void 0,!0):!this.finished};u.prototype.current=
function(){return this.source.charAt(this.index)};u.prototype.moveNext=function(){return++this.index<this.source.length};var j=function(a){return a instanceof c?a:"string"===typeof a?new y(a):a instanceof Array?new k(a):new l(a)};j.async=function(a,b){return new q(new k(a),b)};j.generate=function(a,b){return new p(a,b)};j.range=function(){var a=1<arguments.length?arguments[0]:0,b=1<arguments.length?arguments[1]:arguments[0],c=2<arguments.length?arguments[2]:1;return this.generate(function(b){return a+
c*b}).take(Math.floor((b-a)/c))};j.repeat=function(a,b){return j.generate(function(){return a},b)};j.Sequence=c;j.IndexedSequence=e;j.CachingSequence=g;j.GeneratedSequence=p;"function"===typeof Array.prototype.indexOf&&(v=function(a,b){return-1!==a.indexOf(b)});"undefined"!==typeof module?module.exports=j:w.Lazy=j})("undefined"!==typeof global?global:window);
